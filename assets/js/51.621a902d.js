(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{406:function(e,s,o){"use strict";o.r(s);var t=o(42),a=Object(t.a)({},(function(){var e=this,s=e.$createElement,o=e._self._c||s;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"cosmovisor"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#cosmovisor"}},[e._v("#")]),e._v(" Cosmovisor")]),e._v(" "),o("p",[e._v("The Cosmos team provides a tool named "),o("em",[e._v("Cosmovisor")]),e._v(" that allows your node to perform some automatic operations when needed. This is particularly useful when dealing with on-chain upgrades, because Cosmovisor can help you by taking care of downloading the updated binary and restarting the node for you.")]),e._v(" "),o("p",[e._v("If you want to learn how to setup Cosmovisor inside your full or validator node, please follow the guide below.")]),e._v(" "),o("h2",{attrs:{id:"setup"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#setup"}},[e._v("#")]),e._v(" Setup")]),e._v(" "),o("h3",{attrs:{id:"_1-downloading-cosmovisor"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_1-downloading-cosmovisor"}},[e._v("#")]),e._v(" 1. Downloading Cosmovisor")]),e._v(" "),o("p",[e._v("The first thing you have to do is downloading the "),o("code",[e._v("cosmovisor")]),e._v(" binary file. To do this you can execute the following command:")]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[e._v("go get github.com/cosmos/cosmos-sdk/cosmovisor/cmd/cosmovisor\n")])])]),o("p",[e._v("This will download all the dependencies and build "),o("code",[e._v("cosmovisor")]),e._v(" for your machine. Once that's done, you can execute the following command to make sure that "),o("code",[e._v("cosmovisor")]),e._v(" is installed:")]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[e._v("cosmovisor version\n")])])]),o("p",[e._v("It should print "),o("code",[e._v("DAEMON_NAME is not set")]),e._v(". If that's the case, you have installed "),o("code",[e._v("cosmovisor")]),e._v(" successfully.")]),e._v(" "),o("h3",{attrs:{id:"_2-setting-up-environmental-variables"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_2-setting-up-environmental-variables"}},[e._v("#")]),e._v(" 2. Setting up environmental variables")]),e._v(" "),o("p",[e._v("Cosmovisor relies on the following environmental variables to work properly:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("DAEMON_HOME")]),e._v(" is the location where upgrade binaries should be kept (e.g. "),o("code",[e._v("$HOME/.desmos")]),e._v(").")]),e._v(" "),o("li",[o("code",[e._v("DAEMON_NAME")]),e._v(" is the name of the binary itself (eg. "),o("code",[e._v("desmos")]),e._v(").")]),e._v(" "),o("li",[o("code",[e._v("DAEMON_ALLOW_DOWNLOAD_BINARIES")]),e._v(" ("),o("em",[e._v("optional")]),e._v(") if set to "),o("code",[e._v("true")]),e._v(" will enable auto-downloading of new binaries\n(for security reasons, this is intended for full nodes rather than validators).")]),e._v(" "),o("li",[o("code",[e._v("DAEMON_RESTART_AFTER_UPGRADE")]),e._v(" ("),o("em",[e._v("optional")]),e._v(") if set to "),o("code",[e._v("true")]),e._v(" it will restart the sub-process with the same\ncommand line arguments and flags (but new binary) after a successful upgrade. By default, "),o("code",[e._v("cosmovisor")]),e._v(" dies\nafterwards and allows the supervisor to restart it if needed. Note that this will not auto-restart the child\nif there was an error.")])]),e._v(" "),o("p",[e._v("To properly set those variables, we suggest you to edit the "),o("code",[e._v("~/.profile")]),e._v(" file so that they are loaded when you log into your machine. To edit this file you can simply run")]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[o("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("nano")]),e._v(" ~/.profile\n")])])]),o("p",[e._v("Once you're in, we suggest you to set the following values:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("export DAEMON_HOME=$HOME/.desmos\nexport DAEMON_NAME=desmos\nexport DAEMON_ALLOW_DOWNLOAD_BINARIES=true\nexport DAEMON_RESTART_AFTER_UPGRADE=true\n")])])]),o("p",[e._v("Once you're done, please reload the "),o("code",[e._v("~/.profile")]),e._v(" file by running")]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[o("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("source")]),e._v(" ~/.profile\n")])])]),o("p",[e._v("You can verify the values set by running")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("echo $DAEMON_NAME\n")])])]),o("p",[e._v("If this outputs "),o("code",[e._v("desmos")]),e._v(" you are ready to go.")]),e._v(" "),o("h4",{attrs:{id:"updating-the-service-file"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#updating-the-service-file"}},[e._v("#")]),e._v(" Updating the service file")]),e._v(" "),o("p",[e._v("If you are running your node using a service, you need to update your service file to use "),o("code",[e._v("cosmovisor")]),e._v(" instead of "),o("code",[e._v("desmos")]),e._v(". To do this you can simply run the following command:")]),e._v(" "),o("div",{staticClass:"language-shel extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("sudo systemctl edit desmosd --full\n")])])]),o("p",[e._v("Now, from here, you want your file to look like the following:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('[Unit]\nDescription=Desmos Full Node\nAfter=network-online.target\n\n[Service]\nUser=<your-username>\nExecStart=$GOBIN/cosmovisor start\nRestart=always\nRestartSec=3\nLimitNOFILE=4096\n\nEnvironment="DAEMON_HOME=$HOME/.desmos"\nEnvironment="DAEMON_NAME=desmos"\nEnvironment="DAEMON_ALLOW_DOWNLOAD_BINARIES=true"\nEnvironment="DAEMON_RESTART_AFTER_UPGRADE=true"\n\n[Install]\nWantedBy=multi-user.target\n')])])]),o("div",{staticClass:"custom-block warning"},[o("p",{staticClass:"custom-block-title"},[e._v("Environment variables")]),e._v(" "),o("p",[e._v("Note the "),o("code",[e._v("Environment")]),e._v(" rows. You need to have all of them to make sure "),o("code",[e._v("cosmovisor")]),e._v(" can run properly.")])]),e._v(" "),o("div",{staticClass:"custom-block warning"},[o("p",{staticClass:"custom-block-title"},[e._v("Set correct user")]),e._v(" "),o("p",[e._v("Make sure you replace the "),o("code",[e._v("<your-username>")]),e._v(" value with your local username name.")])]),e._v(" "),o("p",[e._v("Once you have edited your system file, you need to reload it using the following command:")]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[o("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl reload desmosd\n")])])]),o("h3",{attrs:{id:"_3-copying-desmos-files-in-the-proper-folders"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_3-copying-desmos-files-in-the-proper-folders"}},[e._v("#")]),e._v(" 3. Copying Desmos files in the proper folders")]),e._v(" "),o("p",[e._v("In order to work properly, Cosmovisor needs the "),o("code",[e._v("desmos")]),e._v(" binary to be placed in the "),o("code",[e._v("~/.desmos/cosmovisor/genesis/bin")]),e._v(" folder. To do this you can simply run the following command:")]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[o("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" -p ~/.desmos/cosmovisor/genesis/bin/\n"),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$GOBIN")]),e._v("/desmos ~/.desmos/cosmovisor/genesis/bin/\n")])])]),o("p",[e._v("To verify that you have setup everything correctly, you can run the following command:")]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[e._v("cosmovisor version\n")])])]),o("p",[e._v("This should output the Desmos version.")]),e._v(" "),o("h3",{attrs:{id:"_4-restarting-your-node"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_4-restarting-your-node"}},[e._v("#")]),e._v(" 4. Restarting your node")]),e._v(" "),o("p",[e._v("Finally, if you've setup everything correctly you can now restart your node. To do this you can simply stop the running "),o("code",[e._v("desmos start")]),e._v(" and re-start your Desmos node using the following command:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("cosmovisor start\n")])])]),o("h4",{attrs:{id:"restart-your-service"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#restart-your-service"}},[e._v("#")]),e._v(" Restart your service")]),e._v(" "),o("p",[e._v("If you are running Desmos as a service, you can restart is as follows:")]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[o("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl restart desmosd\n")])])])])}),[],!1,null,null,null);s.default=a.exports}}]);